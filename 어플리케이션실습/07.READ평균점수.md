- íŠ¹ì • í•™ìƒì— ëŒ€í•´ í‰ê·  ì ìˆ˜ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.
- íŠ¹ì • ê³¼ëª©ì— ëŒ€í•´ ì „ì²´ í•™ìƒë“¤ì˜ í‰ê·  ì ìˆ˜ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.

# í•™ìƒì˜ í‰ê· ì ìˆ˜ êµ¬í•˜ê¸°(ì—°ê´€ê´€ê³„)

## 1. ë„ë©”ì¸
### 1. ScoreResponse ë„ë©”ì¸
- ìƒì„±ì
    - builder ì‚¬ìš©
- í´ë˜ìŠ¤ ì–´ë…¸í…Œì´ì…˜ ì‚¬ìš©í•˜ì§€ ì•Šì„ ë•Œì˜ ì—ëŸ¬ ë¬¸êµ¬
    ```
    "status": 406,
    "error": "Not Acceptable",
    "message": "Could not find acceptable representation",
    "path": "/student/1/avg-score"
    ```
```
scoreResponse.java

@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class ScoreResponse {

    private String studentName;
    private Double score;
}
```

### 2. Grade ë„ë©”ì¸
- score ê²Œí„° ìƒì„±
```java
public class Grade {

    @Convert(converter = Score.ScoreConverter.class)
    private Score score;

    //...
    
    public Integer getScore() {
        return score.getValue();
    }
}
```

## 2. í•™ìƒ ê°ì²´ì—ì„œ í‰ê· ì ìˆ˜ êµ¬í•˜ëŠ” ë©”ì„œë“œ ìƒì„±
- grades ê°ì²´ì—ì„œ í‰ê· ì ìˆ˜ êµ¬í•˜ê¸° => ğŸŸ¨ ì´ê²Œ ì–´ë–»ê²Œ ê°€ëŠ¥í•œì§€?
    - `JPA ì—°ê´€ê´€ê³„`
```java
student.java>>

public class Student {

    @Id @GeneratedValue
    @Column(name = "student_id")
    private Long id;

    private String name;

    @Embedded
    private Address address;

    //grade í…Œì´ë¸”ì— ìˆëŠ” studentí•„ë“œì— ì˜í•´ ë§¤í•‘ë¨.(ë³€ê²½x, ì½ê¸°ì „ìš©)
    @OneToMany(mappedBy = "student", cascade = CascadeType.ALL)
    private List<Grade> grades = new ArrayList<>();

    //...

    // ğŸŸ¨ grades ì—ì„œ í‰ê· ì ìˆ˜ë¥¼ êµ¬í•¨
    public double getStudentAverageScore() {
        /*
        double sum = 0.0;
        for (Grade grade : grades) {
            sum += grade.getScore();
        }

        return sum / grades.size();
        */

        return grades.stream()
                .mapToInt(Grade::getScore)
                .average()
                .orElseThrow();
    }
```
## ì‘ë‹µê°ì²´ í™œìš©í•´ì„œ ë°˜í™˜
- ì‘ë‹µê°ì²´ì— í•™ìƒê°ì²´ë¥¼ ë‹´ì•„ì„œ ë°˜í™˜
- DDD í™œìš©
```
studentService.java>>

@Transactional(readOnly = true)
public ScoreResponse getStudentAverageScore(Long id) {
    
    Student student = studentRepository.findById(id)
            .orElseThrow(() -> DomainException.notFoundRow(id));

    return ScoreResponse.builder()
            .score(student.getStudentAverageScore())
            .studentName(student.getName())
            .build();
}
```
```
studentController.java>>

@ResponseBody
@GetMapping("/student/{id}/average-score")
@Operation(summary = "í•™ìƒ ì •ë³´ë¥¼ í‰ê·  ì ìˆ˜ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.")
public ResponseEntity<ScoreResponse> getStudentAverageScore(@PathVariable Long id) {

    ScoreResponse response = studentService.getStudentAverageScore(id);

    return ResponseEntity.ok(response);
}
```