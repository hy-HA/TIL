### TODO List
- ì„œë¹„ìŠ¤ì— @Transactionalê³¼ @Serviceê°€ ë¶™ì–´ìˆìœ¼ë©´ ìŠ¤í”„ë§ì»¨í…Œì´ë„ˆì—ëŠ” ì–´ë–»ê²Œ ë¹ˆì´ ë“±ë¡ì´ ë˜ë‚˜?

## ê¸°ì–µí•´ì•¼ í•  ë‚´ìš©
- ìŠ¤í”„ë§ì˜ @Transactionalì˜ 2ê°€ì§€ ê·œì¹™
    1. ìš°ì„ ìˆœìœ„ ê·œì¹™
        - **ìŠ¤í”„ë§ì—ì„œ ìš°ì„ ìˆœìœ„ëŠ” í•­ìƒ ë” êµ¬ì²´ì ì´ê³  ìì„¸í•œ ê²ƒì´ ë†’ì€ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì§„ë‹¤.** 
    2. í´ë˜ìŠ¤ì— ì ìš©í•˜ë©´ ë©”ì„œë“œëŠ” ìë™ ì ìš©

---
# íŠ¸ëœì­ì…˜ ì ìš© í™•ì¸
- íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ì½”ë“œ 
    - boolean txActive = TransactionSynchronizationManager.isActualTransactionActive();

    <details>
        <summary> íŠ¸ëœì­ì…˜ ì ìš© í™•ì¸ í…ŒìŠ¤íŠ¸ ì½”ë“œ</summary>

        
        @Slf4j
        @SpringBootTest
        public class TxBasicTest {

            @Autowired BasicService basicService;

            @Test
            void proxyCheck() {
                log.info("aop class={}", basicService.getClass());
                assertThat(AopUtils.isAopProxy(basicService)).isTrue();
            }

            @Test
            void txTest() {

                //1. í´ë¼ì´ì–¸íŠ¸ê°€ basicService.tx()í˜¸ì¶œ
                basicService.tx();
                //1. í´ë¼ì´ì–¸íŠ¸ê°€ basicService.nonTx()í˜¸ì¶œ
                basicService.nonTx();
            }

            @TestConfiguration
            static class TxApplyBasicConfig {
                @Bean
                BasicService basicService() {
                    return new BasicService();
                }
            }

            @Slf4j
            static class BasicService {

                //2. BasicServiceì˜ tx()ê°€ ì•„ë‹ˆë¼ í”„ë¡ì‹œì˜ tx()ê°€ í˜¸ì¶œë¨
                @Transactional
                public void tx() {
                    log.info("call tx");
                    //íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ì½”ë“œ ğŸ§©
                    boolean txActive = TransactionSynchronizationManager.isActualTransactionActive();
                    log.info("tx active={}", txActive);
                }

                //2. BasicServiceì˜ nonTx()ê°€ ì•„ë‹ˆë¼ í”„ë¡ì‹œì˜ nonTx()ê°€ í˜¸ì¶œë¨
                public void nonTx() {
                    log.info("call nonTx");
                    boolean txActive = TransactionSynchronizationManager.isActualTransactionActive();
                    log.info("tx active={}", txActive);
                }
            }
        }

    </details>


## **ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— íŠ¸ëœì­ì…˜ í”„ë¡ì‹œ ë“±ë¡**

![](https://i.imgur.com/GKf9Ka7.png)
1. @Transactional ì• ë…¸í…Œì´ì…˜ì´ íŠ¹ì • í´ë˜ìŠ¤ë‚˜ ë©”ì„œë“œì— í•˜ë‚˜ë¼ë„ ìˆìœ¼ë©´ ìˆìœ¼ë©´ 
2. íŠ¸ëœì­ì…˜ AOPëŠ” í”„ë¡ì‹œë¥¼ ë§Œë“¤ì–´ì„œ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë“±ë¡í•œë‹¤.
3. ê·¸ë¦¬ê³  ì‹¤ì œ basicService ê°ì²´ ëŒ€ì‹ ì— í”„ë¡ì‹œì¸ basicService$$CGLIB ë¥¼ ìŠ¤í”„ë§ ë¹ˆì— ë“±ë¡í•œë‹¤.
    - ì‹¤ì œ ê°ì²´ ëŒ€ì‹ ì— í”„ë¡ì‹œê°€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë“±ë¡ë¨!
    - í”„ë¡ì‹œëŠ” ë‚´ë¶€ì— ì‹¤ì œ basicService ë¥¼ ì°¸ì¡°í•˜ê²Œ ëœë‹¤.
4. í´ë¼ì´ì–¸íŠ¸ì¸ txBasicTest ëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— @Autowired BasicService basicService ë¡œ ì˜ì¡´ê´€ê³„ ì£¼ì…ì„ ìš”ì²­í•œë‹¤.
5. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ëŠ” ì‹¤ì œ ê°ì²´ ëŒ€ì‹ ì— í”„ë¡ì‹œê°€ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— í”„ë¡ì‹œë¥¼ ì£¼ì…í•œë‹¤.
    - í”„ë¡ì‹œëŠ” BasicService ë¥¼ ìƒì†í•´ì„œ ë§Œë“¤ì–´ì§€ê¸° ë•Œë¬¸ì— ë‹¤í˜•ì„±ì„ í™œìš©í•  ìˆ˜ ìˆë‹¤.
    - ë”°ë¼ì„œ BasicService ëŒ€ì‹ ì— í”„ë¡ì‹œì¸ BasicService$$CGLIB ë¥¼ ì£¼ì…í•  ìˆ˜ ìˆë‹¤.
## **íŠ¸ëœì­ì…˜ í”„ë¡ì‹œ ë™ì‘ ë°©ì‹**
![](https://i.imgur.com/lnZgpQd.png)
### @Transactionalì´ ìˆì„ ë•Œ
1. í´ë¼ì´ì–¸íŠ¸ê°€ basicService.tx() í˜¸ì¶œ
2. basicServiceì˜ tx()ë©”ì†Œë“œê°€ í˜¸ì¶œë˜ëŠ”ê²Œ ì•„ë‹ˆë¼ í”„ë¡ì‹œì˜ tx() ê°€ í˜¸ì¶œëœë‹¤.
    - ì—¬ê¸°ì„œ í”„ë¡ì‹œëŠ” tx() ë©”ì„œë“œê°€ íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•´ë³¸ë‹¤.
    - tx() ë©”ì„œë“œì—ëŠ” @Transactional ì´ ë¶™ì–´ìˆìœ¼ë¯€ë¡œ íŠ¸ëœì­ì…˜ ì ìš© ëŒ€ìƒì´ë‹¤.
3. ë”°ë¼ì„œ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œ ë‹¤ìŒì— ì‹¤ì œ basicService.tx() ë¥¼ í˜¸ì¶œí•œë‹¤.
4. ì‹¤ì œ basicService.tx() ì˜ í˜¸ì¶œì´ ëë‚˜ì„œ í”„ë¡ì‹œë¡œ ì œì–´ê°€(ë¦¬í„´) ëŒì•„ì˜¤ë©´ í”„ë¡ì‹œëŠ” íŠ¸ëœì­ì…˜ ë¡œì§ì„ ì»¤ë°‹í•˜ê±°ë‚˜ ë¡¤ë°±í•´ì„œ íŠ¸ëœì­ì…˜ì„ ì¢…ë£Œí•œë‹¤.
### @Transactionalì´ ì—†ì„ ë•Œ
1. í´ë¼ì´ì–¸íŠ¸ê°€ basicService.nonTx() í˜¸ì¶œ
2. basicServiceì˜ nonTx()ë©”ì†Œë“œê°€ í˜¸ì¶œë˜ëŠ”ê²Œ ì•„ë‹ˆë¼ íŠ¸ëœì­ì…˜ í”„ë¡ì‹œì˜ nonTx() ê°€ í˜¸ì¶œëœë‹¤.
    - ì—¬ê¸°ì„œ nonTx() ë©”ì„œë“œê°€ íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•´ë³¸ë‹¤.
    - nonTx()ì—ëŠ” @Transactional ì´ ì—†ìœ¼ë¯€ë¡œ ì ìš© ëŒ€ìƒì´ ì•„ë‹ˆë‹¤.
3. ë”°ë¼ì„œ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ì§€ ì•Šê³ , basicService.nonTx() ë¥¼ í˜¸ì¶œí•˜ê³  ì¢…ë£Œí•œë‹¤.

# íŠ¸ëœì­ì…˜ ì ìš© ìœ„ì¹˜

## **ìŠ¤í”„ë§ì˜ @Transactionalì˜ 2ê°€ì§€ ê·œì¹™**
1. ìš°ì„ ìˆœìœ„ ê·œì¹™
    - **ìŠ¤í”„ë§ì—ì„œ ìš°ì„ ìˆœìœ„ëŠ” í•­ìƒ ë” êµ¬ì²´ì ì´ê³  ìì„¸í•œ ê²ƒì´ ë†’ì€ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì§„ë‹¤.** ğŸ§©
2. í´ë˜ìŠ¤ì— ì ìš©í•˜ë©´ ë©”ì„œë“œëŠ” ìë™ ì ìš©


### **ìš°ì„ ìˆœìœ„**
* íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•  ë•ŒëŠ” ë‹¤ì–‘í•œ ì˜µì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. 
* ê·¸ëŸ°ë° ì–´ë–¤ ê²½ìš°ì—ëŠ” ì˜µì…˜ì„ ì£¼ê³ , ì–´ë–¤ ê²½ìš°ì—ëŠ” ì˜µì…˜ì„ ì£¼ì§€ ì•Šìœ¼ë©´ ì–´ë–¤ ê²ƒì´ ì„ íƒë ê¹Œ? 
  * ì˜ˆë¥¼ ë“¤ì–´ì„œ ì½ê¸° ì „ìš© íŠ¸ëœì­ì…˜ ì˜µì…˜ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì™€ ì•„ë‹Œ
  ê²½ìš°ë¥¼ ë¹„êµí•´ë³´ì. (ì½ê¸° ì „ìš© ì˜µì…˜ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ ë’¤ì—ì„œ ë‹¤ë£¬ë‹¤. ì—¬ê¸°ì„œëŠ” ì ìš© ìˆœì„œì— ì§‘ì¤‘í•˜ì.)
* LevelService ì˜ íƒ€ì…ì— @Transactional(readOnly = true) ì´ ë¶™ì–´ìˆë‹¤.
* write() : í•´ë‹¹ ë©”ì„œë“œì— @Transactional(readOnly = false) ì´ ë¶™ì–´ìˆë‹¤.
  * ì´ë ‡ê²Œ ë˜ë©´ íƒ€ì…ì— ìˆëŠ” @Transactional(readOnly = true) ì™€ í•´ë‹¹ ë©”ì„œë“œì— ìˆëŠ”
  @Transactional(readOnly = false) ë‘˜ ì¤‘ í•˜ë‚˜ë¥¼ ì ìš©í•´ì•¼ í•œë‹¤.
  * í´ë˜ìŠ¤ ë³´ë‹¤ëŠ” ë©”ì„œë“œê°€ ë” êµ¬ì²´ì ì´ë¯€ë¡œ ë©”ì„œë“œì— ìˆëŠ” @Transactional(readOnly = false)
  ì˜µì…˜ì„ ì‚¬ìš©í•œ íŠ¸ëœì­ì…˜ì´ ì ìš©ëœë‹¤.

### **í´ë˜ìŠ¤ì— ì ìš©í•˜ë©´ ë©”ì„œë“œëŠ” ìë™ ì ìš©**
* read() : í•´ë‹¹ ë©”ì„œë“œì— @Transactional ì´ ì—†ë‹¤. ì´ ê²½ìš° ë” ìƒìœ„ì¸ í´ë˜ìŠ¤ë¥¼ í™•ì¸í•œë‹¤.
  * í´ë˜ìŠ¤ì— @Transactional(readOnly = true) ì´ ì ìš©ë˜ì–´ ìˆë‹¤. ë”°ë¼ì„œ íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ê³ 
  readOnly = true ì˜µì…˜ì„ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.
* ì°¸ê³ ë¡œ readOnly=false ëŠ” ê¸°ë³¸ ì˜µì…˜ì´ê¸° ë•Œë¬¸ì— ë³´í†µ ìƒëµí•œë‹¤. 
  *  @Transactional == @Transactional(readOnly=false) ì™€ ê°™ë‹¤

## **ì¸í„°í˜ì´ìŠ¤ì— @Transactional ì ìš©**
* ì¸í„°í˜ì´ìŠ¤ì—ë„ @Transactional ì„ ì ìš©í•  ìˆ˜ ìˆë‹¤. ì´ ê²½ìš° ë‹¤ìŒ ìˆœì„œë¡œ ì ìš©ëœë‹¤. 
* êµ¬ì²´ì ì¸ ê²ƒì´ ë” ë†’ì€ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì§„ë‹¤ê³  ìƒê°í•˜ë©´ ë°”ë¡œ ì´í•´ê°€ ë  ê²ƒì´ë‹¤.
1. í´ë˜ìŠ¤ì˜ ë©”ì„œë“œ (ìš°ì„ ìˆœìœ„ê°€ ê°€ì¥ ë†’ë‹¤.)
2. í´ë˜ìŠ¤ì˜ íƒ€ì…
3. ì¸í„°í˜ì´ìŠ¤ì˜ ë©”ì„œë“œ
4. ì¸í„°í˜ì´ìŠ¤ì˜ íƒ€ì… (ìš°ì„ ìˆœìœ„ê°€ ê°€ì¥ ë‚®ë‹¤.)

- í´ë˜ìŠ¤ì˜ ë©”ì„œë“œë¥¼ ì°¾ê³ , ë§Œì•½ ì—†ìœ¼ë©´ í´ë˜ìŠ¤ì˜ íƒ€ì…ì„ ì°¾ê³  ë§Œì•½ ì—†ìœ¼ë©´ ì¸í„°í˜ì´ìŠ¤ì˜ ë©”ì„œë“œë¥¼ ì°¾ê³  ê·¸ë˜ë„ ì—†ìœ¼ë©´ ì¸í„°í˜ì´ìŠ¤ì˜ íƒ€ì…ì„ ì°¾ëŠ”ë‹¤.
- ê·¸ëŸ°ë° ì¸í„°í˜ì´ìŠ¤ì— @Transactional ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ìŠ¤í”„ë§ ê³µì‹ ë©”ë‰´ì–¼ì—ì„œ ê¶Œì¥í•˜ì§€ ì•ŠëŠ” ë°©ë²•
    - AOPë¥¼ ì ìš©í•˜ëŠ” ë°©ì‹ì— ë”°ë¼ì„œ ì¸í„°í˜ì´ìŠ¤ì— ì• ë…¸í…Œì´ì…˜ì„ ë‘ë©´ AOPê°€ ì ìš©ì´ ë˜ì§€ ì•ŠëŠ” ê²½ìš°ë„ ìˆê¸° ë•Œë¬¸ì´ë‹¤. 
    - ê°€ê¸‰ì  êµ¬ì²´ í´ë˜ìŠ¤ì— @Transactional ì„ ì‚¬ìš©í•˜ì.

- ì°¸ê³ 
> ìŠ¤í”„ë§ì€ ì¸í„°í˜ì´ìŠ¤ì— @Transactional ì„ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì„ ìŠ¤í”„ë§ 5.0ì—ì„œ ë§ì€ ë¶€ë¶„ ê°œì„ í–ˆë‹¤.  
> ê³¼ê±°ì—ëŠ” êµ¬ì²´ í´ë˜ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í”„ë¡ì‹œë¥¼ ìƒì„±í•˜ëŠ” CGLIB ë°©ì‹ì„ ì‚¬ìš©í•˜ë©´ ì¸í„°í˜ì´ìŠ¤ì— ìˆëŠ” @Transactional ì„ ì¸ì‹í•˜ì§€ ëª»í–ˆë‹¤.   
> ìŠ¤í”„ë§ 5.0 ë¶€í„°ëŠ” ì´ ë¶€ë¶„ì„ ê°œì„ í•´ì„œ ì¸í„°í˜ì´ìŠ¤ì— ìˆëŠ” @Transactional ë„ ì¸ì‹í•œë‹¤. 
> í•˜ì§€ë§Œ ë‹¤ë¥¸ AOP ë°©ì‹ì—ì„œ ë˜ ì ìš©ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê³µì‹ ë©”ë‰´ì–¼ì˜ ê°€ì´ë“œëŒ€ë¡œ ê°€ê¸‰ì  êµ¬ì²´ í´ë˜ìŠ¤ì— @Transactional ì„ ì‚¬ìš©í•˜ì.
> CGLIB ë°©ì‹ì€ ìŠ¤í”„ë§ í•µì‹¬ì›ë¦¬ - ê³ ê¸‰í¸ì—ì„œ ì„¤ëª…