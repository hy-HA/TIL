# soft delete ì™€ hard delete

# hard delete
```
@Transactional
public void deleteStudent(Long id) {

    studentRepository.deleteById(id);     

}
```

# soft delete 
- ë„ë©”ì¸ì—ì„œ delete ì»¬ëŸ¼ ì„¤ì •
## 1. í™•ì¥ë°›ì„ BaseEntity ìƒì„± 
- BaseEntity ì–´ë…¸í…Œì´ì…˜
    1. @Getter
    2. @MappedSuperclass 
    3. @EntityListeners(AuditingEntityListener.class) ğŸŸ¨
    [ê°œë…ì •ë¦¬](https://hackmd.io/YpHn8z9xQOiqfyUK226_eQ)
```
@Getter
@MappedSuperclass
@EntityListeners(AuditingEntityListener.class)
public class BaseEntity {

    @CreatedDate
    private LocalDateTime createdDate;

    @LastModifiedDate
    private LocalDateTime modifiedDate;

    //ğŸ§©ìƒì†ë°›ëŠ” í´ë˜ìŠ¤ë“¤ì´ ì‚¬ìš©í•˜ë ¤ë©´?
    protected Boolean isDeleted;

    public void delete() {
        this.isDeleted = true;
    }

}
```
## 2. í™•ì¥í•˜ëŠ” Student ë„ë©”ì¸ì—ì„œ where ì–´ë…¸í…Œì´ì…˜ ì‚¬ìš©
### @Where(clause = "is_deleted = false")
- ì—­í•  ğŸŸ¨
    - BaseEntityì—ì„œ ì •ì˜í•œ delete()ë©”ì†Œë“œë¥¼ í™•ì¥í•˜ëŠ”ë„ë©”ì¸.delete()ë¡œ ì‚¬ìš©ê°€ëŠ¥í•˜ê²Œ í•¨. 
```
@Getter
@NoArgsConstructor
@Entity
@Table(name="student")
@Where(clause = "is_deleted = false")
// @SQLDelete(sql = "update student set is_deleted = true where student_id = ?")
public class Student extends BaseEntity {

    @Id @GeneratedValue
    @Column(name = "student_id")
    private Long id;

    private String name;

    private int score;

    @Builder
    public Student(String name, int score){
        this.name = name;
        this.score = score;
        this.isDeleted = false;
    }
```

## 3. ì„œë¹„ìŠ¤ì—ì„œ ì‚­ì œê¸°ëŠ¥ ì‚¬ìš©
- ì˜µì…”ë„ì˜ ì˜ˆì™¸ì²˜ë¦¬ 
    - [ì°¸ê³  : í”„ë¡œê·¸ë˜ë°ì˜ ì˜¤ë¥˜ì™€ ì˜ˆì™¸](https://hackmd.io/GJc-8M34RhikhvlyUNiCoQ)
- `Optional.orElseThrow()`
```
@Transactional
public void deleteStudent(Long id) {
    
    //(1) hard delete
    studentRepository.deleteById(id);     

    //(2) soft delete
    Student student = studentRepository.findById(id)
                .orElseThrow(() -> DomainException.notFoundRow(id));
    student.delete();   
}
```

## 4. ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì„¤ì •
### ì»¨íŠ¸ë¡¤ëŸ¬ì˜ íŠ¹ì§•
1. íŒŒë¼ë¯¸í„°ì— ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ì•¼
    - @RequestBody
    - @PathVariable
2. ì£¼ì†Œë¥¼ ì•Œë ¤ì¤˜ì•¼ 
    - @PatchMapping("/grade/{id}/score)
3. ì»¨íŠ¸ë¡¤ëŸ¬ ì—ë…¸í…Œì´ì…˜
    - @ResponseBody
    - @RequiredArgsConstructor
    - @RequestMapping("/student")
### @PathVariable
- ì‚­ì œì˜ ê²½ìš° íŒŒë¼ë¯¸í„°ë¡œ idê°’ì„ ë°›ìœ¼ë¯€ë¡œ @RequestBodyê°€ ì•„ë‹ˆë¼ @PathVariable
```
@ResponseBody
    @DeleteMapping("/{id}")
    public ResponseEntity<StudentResponse> deleteStudent(@PathVariable Long id) {
        studentService.deleteStudent(id);
        return ResponseEntity.status(HttpStatus.NO_CONTENT).build();
    }
```
