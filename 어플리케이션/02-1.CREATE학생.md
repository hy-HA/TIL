# í•™ìƒ ìƒì„±í•˜ê¸°

## ìˆœì„œ
1. ë°ì´í„° ë°›ê¸°

    - Controller 
        - ë°›ì„/ë³´ë‚¼ ë°ì´í„°ì˜ íƒ€ì… ì„¤ì •
            - @RestController :  HTTP ì‘ë‹µë°ì´í„°(body)ì— ìë°” ê°ì²´ê°€ ë§¤í•‘ë˜ì–´ ì „ë‹¬(ë°”ë””ë¥¼ ìë°”ê°ì²´ë¡œ ë°›ê¸°)
            - @RequestBody : JSONìœ¼ë¡œ ë°›ì€ ìš”ì²­ ë°ì´í„°ë¥¼ ìë°”Object ë¡œ ë³€í™˜ í›„ StudentFormê°ì²´ì— ë‹´ì•„ì£¼ê³ 
            - @ResponseBody : Java Object -> (JSON or XML)ë¡œì˜ ë³€í™˜
            - @ResponseEntity : 
        - ë°ì´í„°ë¥¼ ë°›ì„ ì£¼ì†Œ ì„¤ì •
            - @RequestMapping : ì–´ë–¤ urlì—ì„œ ë°ì´í„°ë¥¼ ë°›ì„ì§€ ì„¤ì •
        - ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ëŠ” í˜•ì‹ ì„¤ì •
            - @PostMapping : í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë°›ì€ ë°ì´í„°ë¥¼ ì„œë²„ì— ì „ì†¡
        
    - DTO(StudentFrom) : í´ë¼ì´ì–¸íŠ¸ê°€ ì „ì†¡í•  ë°ì´í„°ë¥¼ ë°›ì„ ê°ì²´
        - íƒ€ì…ê³¼ ë³€ìˆ˜ ì„¤ì •
        - validation â›‘
            - @NotNull
2. ê°ì²´ ìƒì„± & ë°ì´í„° ë°˜í™˜
- DBí…Œì´ë¸”ì— ë§¤í•‘í•  ì—”í‹°í‹° ì„¤ì •
    - ì„œë¹„ìŠ¤
        - request ê°ì²´ ì „ë‹¬ë°›ì•„ì„œ
            - ì˜ˆì™¸ì²˜ë¦¬ â›‘
                1. ì»¤ìŠ¤í…€ ìµì…ˆì…˜ í´ë˜ìŠ¤ ìƒì„±
                2. request ê°ì²´ ì˜ˆì™¸ì²˜ë¦¬
        - í•™ìƒ ê°ì²´ ë§Œë“¤ê³ 
            - builder ì‚¬ìš©
            - ì´ë•Œ idëŠ” ìë™ìƒì„±ë¨
        - ë¦¬í¬ì§€í† ë¦¬ì— ì €ì¥
            - ì €ì¥íƒ€ì…ì€ ì—”í‹°í‹°(student)
                - ë¦¬í¬ì§€í† ë¦¬ì—ì„œ ì„ ì–¸í•œ íƒ€ì…ìœ¼ë¡œ ì „ë‹¬í•´ì•¼
        - response ê°ì²´ë¡œ ë³€í™˜í•´ì„œ ì „ë‹¬
    - ì»¨íŠ¸ë¡¤ëŸ¬
        - ResponseEntity ì‚¬ìš©

# ì»¨íŠ¸ë¡¤ëŸ¬ ğŸŸ¨
1. request ë°ì´í„°ë¥¼ @RequestBodyë¡œ ë°›ì•„ì„œ 
2. studentê°ì²´ CREATE í›„
3. @ResponseBodyë¡œ ë°˜í™˜


```java
@RestController
@RequiredArgsConstructor
public class SubjectController {
    
    private final SubjectService subjectService;
    
    @ResponseBody
    @PostMapping("/subject")
    public ResponseEntity<SubjectResponse> createSubject(@RequestBody SubjectForm request){
        SubjectResponse subjectResponse = subjectService.createSubject(request);
        return ResponseEntity.ok(subjectResponse);
    }
}
```
### í´ë˜ìŠ¤ ì–´ë…¸í…Œì´ì…˜
- @RestController ğŸŸ¨ | @RequiredArgsConstructor

### ë©”ì†Œë“œ ì–´ë…¸í…Œì´ì…˜
- @ResponseBody ğŸŸ¨ | @PostMapping("/subject")
### íŒŒë¼ë¯¸í„° ì–´ë…¸í…Œì´ì…˜
- @RequestBody
### ë°˜í™˜ê°ì²´ ResponseEntity
- ResponseEntityë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ  ğŸŸ¨
    - `ResponseEntity.status(HttpStatus.NO_CONTENT).build()`
    - `ResponseEntity.ok(subjectResponse)`


# ë„ë©”ì¸
1. DBí…Œì´ë¸”ì— ë§¤ì¹­í•  `ì—”í‹°í‹°` ìƒì„±
    - `primary key` ì§€ì •
    - í•„ìš”í•œ í•„ë“œ ì„ ì–¸
2. ì„œë¹„ìŠ¤ ë‹¨ê³„ì—ì„œ ê°€ì ¸ë‹¤ ì“¸ `ìƒì„±ì` ë§Œë“¤ì–´ë‘ê¸° 
### í´ë˜ìŠ¤ ì–´ë…¸í…Œì´ì…˜
- @Getter | @NoArgsConstructor | @Entity | @Table(name="student")
### Primary Key
- entityëŠ” primaryí‚¤ê°€ í•„ìˆ˜ë¡œ í•„ìš”
### ìƒì„±ì ì„ ì–¸
- request ë°ì´í„°ë¥¼ @RequestBodyë¡œ ë°›ì•„ì„œ studentê°ì²´ ìƒì„±í›„ ë°˜í™˜
    - ì»¨íŠ¸ë¡¤ëŸ¬ ë‹¨ê³„ ì°¸ê³ 
- Builer
    - íŒŒë¼ë¯¸í„°ì˜ ë§¤ê°œë³€ìˆ˜(tomato)ê°€ Builderì‚¬ìš©ì‹œ ì†ì„± ê°’(?)ì´ ë¨.ğŸ§©ğŸŸ¨
```java
Student.java>>

@Getter
@NoArgsConstructor
@Entity
@Table(name="student")
@Where(clause="is_deleted = false")
public class Student {
    
    //entityëŠ” primaryí‚¤ê°€ í•„ìˆ˜ë¡œ í•„ìš”
    @Id @GeneratedValue
    private Long id;

    private String studentName;

    @Delegate
    @Embedded
    private Address address;

    //í´ë˜ìŠ¤ê°ì²´ìƒì„±3ê°€ì§€ë°©ë²• > @Builderì›ë¦¬ ì°¸ê³ 
    @Builder
    public Student(String tomatoğŸ§©, Address cherryğŸ§©){
        this.studentName = tomato;
        this.address = cherry;
        this.isDeleted = false;
    }
}
```
```java
Address.java>>

@Embeddable
@Getter
@NoArgsConstructor
public class Address {

    private String city;
    private String street;
    private String zipcode;

    @Builder
    public Address(String city, String street, String zipcode){
        this.city = city;
        this.street = street;
        this.zipcode = zipcode;
    }
}
```
```java
BaseEntity.java>>

@Getter
@MappedSuperclass
@EntityListeners(AuditingEntityListener.class)
public class BaseEntity {

    @CreatedDate
    private LocalDateTime createdDate;

    @LastModifiedDate
    private LocalDateTime modifiedDate;

    public boolean isDeleted;

    public void delete(){
        this.isDeleted = true;
    }
}
```
# DTO
## Request ê°ì²´
1. í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë°ì´í„°ë¥¼ ë°›ì•„ì˜´
2. validation ê²€ì‚¬ â›‘

### í´ë˜ìŠ¤ ì–´ë…¸í…Œì´ì…˜
- @Data | @AllArgsConstructor | @NoArgsConstructor
### validation â›‘
- @NotNull   
```java
StudentRequest.java>>

@Data
//@AllArgsConstructor
//@NoArgsConstructor
public class StudentRequest {

    //validation
    @NotNull
    private String studentName;
    private String city;
    private String street;
    private String zipcode;
}
```
## Response ê°ì²´
1. Entityê°ì²´ë¥¼ response ê°ì²´ë¡œ ë°˜í™˜
    1. ìƒì„±ì í•„ìš” ğŸ§©
    2. primary í•„ë“œ í•„ìš” ğŸ§©
### í´ë˜ìŠ¤ ì–´ë…¸í…Œì´ì…˜ 
- ìƒë™
### Primary Key í•„ë“œ ğŸ§©
- Entityê°ì²´ë¥¼ ë°›ì•„ ë°˜í™˜í•˜ë¯€ë¡œ request ê°ì²´ì™€ ë‹¤ë¥´ê²Œ idí•„ë“œê°€ í•„ìš”
### ë°˜í™˜ê°ì²´ ìƒì„±ì ğŸ§©
- Entityê°ì²´ë¥¼ ë°›ì•„ì„œ Response ê°ì²´ë¡œ ë³€í™˜


```java
StudentResponse.java>>

@Data
//@AllArgsConstructor
//@NoArgsConstructor
public class StudentResponse {
    private Long id;

    private String studentName;
    private String city;
    private String street;
    private String zipcode;

    public StudentResponse(Student student){
        this.id = student.getId();
        this.studentName = student.getStudentName();
        this.city = student.getCity();
        this.street = student.getStreet();
        this.zipcode = student.getZipcode();
    }
}
```
# ë¦¬í¬ì§€í† ë¦¬
### JPAë¦¬í¬ì§€í† ë¦¬ ìƒì†ë°›ê¸°
- JPAë¦¬í¬ì§€í† ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ë°˜í™˜ê°’ì´ Optional.
- Optional í•˜ë‚˜ì˜ ì»¬ë ‰ì…˜ì´ë¼ ìƒê°í•˜ë©´ë¨.
- JAPë¦¬í¬ì§€í† ë¦¬ëŠ” ì œë„¤ë¦­í´ë˜ìŠ¤
    - ìƒì† ì‹œ íƒ€ì… ëª…ì‹œí•´ì•¼ í•¨
    - íŒŒë¼ë¯¸í„°ë¡œ ê°ì²´ íƒ€ì… ì§€ì •í•´ì¤˜ì•¼ ì˜¤ë¥˜ê°€ ë‚˜ì§€ ì•ŠëŠ”ë‹¤ ğŸ§©
- ì™œ <STudent, Long> ì¸ê°€? ğŸŸ¨


### Optional í´ë˜ìŠ¤ 
- [ì°¸ê³ ](https://hackmd.io/PYSOOajbS_KBLATJCc_-Lg)
```java
public interface StudentRepository extends JpaRepository<Student,Long> {}
```

# ì„œë¹„ìŠ¤
1. Requestê°ì²´ë¥¼ ì „ë‹¬ë°›ì•„ì„œ(StudentForm)
2. Requestê°ì²´ ì˜ˆì™¸ì²˜ë¦¬ í•´ì£¼ê³  `â›‘(validation)`
3. í•™ìƒê°ì²´ë¥¼ ë§Œë“¤ì–´ì£¼ê³ (Student)
    - builder ì‚¬ìš©
    - ì´ë•Œ idëŠ” ìë™ ìƒì„±ë¨(@Id, @GeneratedValue)
4. ë¦¬í¬ì§€í† ë¦¬ì— ì €ì¥í•˜ê³ (ì €ì¥íƒ€ì…ì€ Student)
    - ë¦¬í¬ì§€í† ë¦¬ëŠ” ì œë„¤ë¦­ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ê³  ìˆìœ¼ë¯€ë¡œ 
    - ë¦¬í¬ì§€í† ë¦¬ì—ì„œ ì„ ì–¸í•œ íƒ€ì…ìœ¼ë¡œ ì „ë‹¬í•´ì£¼ì–´ì•¼í•¨
5. responseê°ì²´ë¡œ ë³€í™˜í•´ì„œ ì „ë‹¬(StudentResponse)

```java
@Service
@RequiredArgsConstructor
public class StudentService {
    private final StudentRepository studentRepository;

    @Transactional
    public StudentResponse createStudent(StudentForm request) {

        //validation â›‘
        if(request.getStudentName() == null){
            throw new NullException(request.getName());
        }
        //í•™ìƒ ê°ì²´ ìƒì„±í•´ì„œ requestì—ì„œ ë°›ì€ ë‚´ìš© ë³€í™˜í•´ì£¼ê¸° ğŸ§©
        Student student = Student.builder()
                .name(request.getStudentName())
                .build();
        //í•™ìƒ ê°ì²´ë¥¼ ë¦¬í¬ì§€í† ë¦¬ì— ì €ì¥(ë¦¬í¬ì§€í† ë¦¬ëŠ” í•™ìƒê°ì²´ë¡œ ë°›ê¸° ë•Œë¬¸)
        studentRepository.save(student);

        //ë¦¬í¬ì§€í† ë¦¬ì— ì €ì¥í•œ í•™ìƒê°ì²´ë¥¼ responseê°ì²´ë¡œ ë‹´ì•„ì„œ ë°˜í™˜
        return new StudentResponse(student);
    }
```

# ì»¤ìŠ¤í…€ ìµì…‰ì…˜ â›‘
- `(validation)`
```java
@ResponseStatus(code = HttpStatus.INTERNAL_SERVER_ERROR, reason = "nullê°’ì€ í—ˆìš©í•˜ì§€ ì•ŠìŒ")
public class NullException extends RuntimeException {

    public NullException(String message) {
        super(message);
    }

    public static NullException notNull() {
        return new NullException("ê³µë°±ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
    }
}

```


