# 스프링 부트 환경에서 서블릿 등록&사용

## 1. 서블릿 환경 구성

- 스프링 부트
    - 톰캣 서버를 내장하고 있으므로, 톰캣 서버 설치 없이 편리하게 서블릿 코드를 실행할 수 있다.
## 1. @ServletComponentScan
- 스프링 부트는 서블릿을 직접 등록해서 사용할 수 있도록 @ServletComponentScan을 지원
- @ServletComponentScan가 붙은 패키지의 하위 패키지까지 서블릿을 다 찾아서 등록
```
@ServletComponentScan //서블릿 자동 등록 
@SpringBootApplication
public class ServletApplication {
    public static void main(String[] args) {
        SpringApplication.run(ServletApplication.class, args);
```
## 2. HttpServlet을 상속받은 클래스에 실제 동작할 서블릿 코드를 등록
1. @WebServlet
    - name: 서블릿 이름 
    - urlPatterns: URL 매핑
    - 위 2개는 겹치면 안됨
2. service 메서드 오버라이드
- HTTP 요청을 통해 매핑된 URL이 호출되면 서블릿 컨테이너는 service 메서드를 실행
```
@WebServlet(name = "helloServlet", urlPatterns = "/hello")
  public class HelloServlet extends HttpServlet {

    //ctrl + o -> service 열쇠모양
    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        System.out.println("HelloServlet.service");
        //request,response 구현체 출력 
        System.out.println("request = " + request);
        System.out.println("response = " + response);
        
        //파라미터 받아서 출력
        String username = request.getParameter("username");
        System.out.println("username = " + username);
        
        //응답하기
        response.setContentType("text/plain");
        response.setCharacterEncoding("utf-8");
        response.getWriter().write("hello " + username);
 }
```
## 3. HTTP 요청 메시지 로그로 확인하기
- application.properties
    - logging.level.org.apache.coyote.http11=debug
- 서버를 다시 시작하고, 요청해보면 서버가 받은 HTTP 요청 메시지를 출력하는 것을 확인


## 3. 서블릿 컨테이너 동작 방식
1. 스프링 부트 실행
2. 내장 톰캣 서버 실행(WAS)
    - 내부에 서블릿 컨테이너 가짐
3. 서블릿 컨테이너
    - 서블릿 생성
4. HTTP 요청
5. 톰캣 서버(WAS)
    - HTTP요청을 기반으로 생성된 request, response 객체 생성후 
    - 기존에 만들어진 서블릿 객체 호출하면서 request, response 객체 전달
    - response 객체 정보로 HTTP응답 반환

## 4. welcome 페이지 추가
- webapp 경로에 index.html 을 두면 http://localhost:8080 호출시 index.html 페이지가 열림