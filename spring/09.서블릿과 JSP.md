JSP와 서블릿은 거의 같음.
Spring은 서블릿을 발전시킨 것

## 서블릿

- 서블릿은 싱글톤. 1개의 인스턴스(객체)만 만들어짐. 

## 1. 컨트롤러 vs 서블릿

- Url의 편의성
    - 서블릿은 1개의 Url당 1개의 클래스만 가능. 
    - 컨트롤러는 1개의 클래스에 여러개의 Url가능
- 컨트롤러는 필요한 매개변수만 사용할 수 있음(reqeust만 사용할 수 있음)
- 컨트롤러는 상속이 필요하지 않음. 

```
// @Webservlet = @Controller + @RequestMapping => 1개의 Url당 1개의 클래스만 가능.
// HttpServlet 상속받아야. 
@WebServlet("/rollDice2")
public class TwoDiceServlet extends HttpServlet {
    int getRandomInt(int range) {
	return new Random().nextInt(range)+1;
    }

    //메서드는 service
    public void service(HttpServletRequest request, HttpServletResponse response) throws IOException {
        int idx1 = getRandomInt(6);
        int idx2 = getRandomInt(6);

        response.setContentType("text/html");
        response.setCharacterEncoding("utf-8");
        PrintWriter out = response.getWriter();
        out.println("<html>");
        out.println("<head>");
        out.println("</head>");
        out.println("<body>");
        out.println("<img src='resources/img/dice"+idx1+".jpg'>");
        out.println("<img src='resources/img/dice"+idx2+".jpg'>");
        out.println("</body>");
        out.println("</html>");
        out.close();	    
    }
}
```

## 2. 서블릿의 생명주기

- servlet Context안에는 children이라는 멤버가 있음. 
    - servlet Context에 포함된 서블릿들이 children에 등록이 되어있음. 
    - 요청 시 서블릿 인스턴스가 존재하는지 children에서 확인. 
<img src="img3">

```
@WebServlet("/hello")
	public class HelloServlet extends HttpServlet {

		@Override
		public void init() throws ServletException {  
            // 서블릿이 초기화될때 자동 호출되는 메서드
			// 서블릿 초기화 작업 담당 - 서블릿이 생성 또는 리로딩 때, 단 한번만 수행됨.
			System.out.println("[HelloSerlvet] init()");
		}
		   
		@Override // 호출될 때마다 반복적으로 수행됨.
		public void service(HttpServletRequest request, HttpServletResponse response) {
			// 1. 입력
			// 2. 처리 
			// 3. 출력
			System.out.println("[HelloSerlvet] service()");
		}
	
		@Override   
		public void destroy() {   
			// 뒷정리 작업 - 서블릿이 제거(unload)될 때, 단 한번만 수행됨.
			System.out.println("[HelloSerlvet] destroy()");  
		}
	}
```

## 3. JSP(java server pages)란
- jsp로 작성하면 자동으로 서블릿으로 변환됨. 
    - twoDice.jsp파일은 TwoDiceServlet로 변환되는 것. 
    - jsp : HTML안에 java코드(<% 자바코드 %>, <%= 값 %>)가 있는 것. 
- jsp파일 : src/main/webapp안에 생성. 
- jsp파일은 자동으로 맵핑이 되기 때문에 웹 서블릿써서 맵핑할 필요가 없음
    - localhost/ch2/twoDice.jsp

## 4. JSP와 서블릿의 비교
```
twoDice.jsp>>

<%-- <%! 클래스 영역 %> --%> //iv, cv선언 => 서블릿파일의 클래스 안으로 들어감. 
<%!  
	int getRandomInt(int range){
		return new Random().nextInt(range)+1;
	}
%>
<%-- <%  메서드 영역 - service()의 내부 %> --%> // 서블릿파일의 service메서드 안으로 들어감
<%
	int idx1 = getRandomInt(6);
	int idx2 = getRandomInt(6);
%>
<html>  // out.println();안으로 들어감
<head>
	<title>twoDice.jsp</title>
</head>
<body>
	<img src='resources/img/dice<%=idx1%>.jpg'>
	<img src='resources/img/dice<%=idx2%>.jpg'>
</body>
</html>
```

## 4. JSP의 호출과정
<img src="img4">
- 호출과정
    - 확장자가 jsp인 요청이 오면 jspServlet이 받은 후, 서블릿 인스턴스가 존재하는지 확인. 
    - 없으면 jsp파일을 서블릿으로 변환(.java)
    - 컴파일(class파일)
    - 초기화(jspInit() 메서드)
    - 서블릿 인스턴스 생성(jspService() 메서드)
- 초기화 시 시간이 좀 걸림. (변환, 컴파일 등)
    - 요청이 올때 초기화 함(lazy-init)
    - 스프링은 요청이 오지 않아도 미리 객체를 만들어두고 초기화 해 둠.(early-init) 

## 6. JSP 기본객체
- 기본객체 : 생성없이(선언하지 않고) 사용할 수 있는 객체
    - 서비스 메서드의 지역변수(lv)로 선언이 되어있음
        - request
        - response
        - session
        - config
        - application
        - out
        - page
        - pageContext